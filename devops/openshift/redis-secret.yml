apiVersion: template.openshift.io/v1
kind: Template
metadata:
  name: ${NAME}-pre-req
labels:
  app: ${NAME}
  template: ${NAME}-creds
objects:
  - apiVersion: v1
    kind: Secret
    metadata:
      name: ${NAME}-creds
    stringData:
      clustermode: "yes"
      password: ${PASSWORD}
      redis.conf: |
        cluster-enabled yes
        cluster-require-full-coverage no
        cluster-node-timeout 15000
        cluster-config-file /data/nodes.conf
        cluster-migration-barrier 1
        appendonly yes
        appendfsync ${APPEND_ONLY_FSYNC}
        protected-mode no
        requirepass ${PASSWORD}
    type: Opaque
parameters:
  - name: NAME
    description: The name of the application for labelling all artifacts.
    displayName: Application Name
    required: true
    value: redis
  - name: APPEND_ONLY
    description: The file format mode that Redis will save in (no for RDB, yes for AOF)
    displayName: Redis Persistence Mode
    required: true
    value: "no"
  - name: APPEND_ONLY_FSYNC
    description: The fsync policy of AOF(Append only file).
    displayName: Redis
    required: true
    value: always
  - name: REDIS_USER
    description: Redis master user.
    displayName: Redis master user.
    required: true
    value: redis
  - name: PASSWORD
    description: Redis password
    displayName: Redis password
    generate: expression
    from: "[a-zA-Z0-9]{32}"
    required: true
